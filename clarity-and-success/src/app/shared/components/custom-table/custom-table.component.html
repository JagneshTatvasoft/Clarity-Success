<div>
  <!-- Column selector -->

  <!-- Table -->
  <div class="overflow-x-auto rounded-lg shadow bg-white">
    <table
      mat-table
      [dataSource]="dataSource"
      class="w-full text-sm custom-table"
      [class.collapsed]="collapsed"
    >
      <!-- Select Checkbox Column -->
      @if(isSelectable){
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>Select</th>
        <td mat-cell *matCellDef="let row" class="px-4 py-2 border-b">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)"
          >
          </mat-checkbox>
        </td>
      </ng-container>
      } @if(isEditable){
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef>action</th>
        <td mat-cell *matCellDef="let row" class="px-4 py-2 border-b">
          <mat-icon>edit</mat-icon>
        </td>
      </ng-container>
      }

      <!-- <ng-container *ngFor="let col of displayedColumns" [matColumnDef]="col.key + 1">
        <th mat-header-cell *matHeaderCellDef="filter"></th>
      </ng-container> -->

      <!-- Dynamic Columns -->
      <ng-container *ngFor="let col of displayedColumns" [matColumnDef]="col.key">
        <!-- Header -->
        <th mat-header-cell *matHeaderCellDef>
          @if(tableFilter){
          <div class="flex flex-col justify-center">
            <span class="font-medium text-center">{{ col.label }}</span>

            <div>
              <mat-form-field appearance="outline" class="table-filter mt-1">
                <input
                  matInput
                  [placeholder]="col.label"
                  class="text-xs px-2 py-1 border-b bg-gray-50 w-full"
                />
              </mat-form-field>
            </div>
          </div>
          } @else {
          {{ col.label }}
          }
        </th>

        <!-- Cell -->
        <td mat-cell *matCellDef="let element" class="px-4 py-2 border-b">
          {{ getCellValue(col, element) }}
        </td>
      </ng-container>

      <!-- Render Rows -->
      <tr
        mat-header-row
        *matHeaderRowDef="displayedHeader; sticky: true"
        class="whitespace-nowrap"
      ></tr>
      <!-- Second header row: filters
      <tr mat-header-row *matHeaderRowDef="filterHeader; headerCellDef: filter"></tr> -->
      <tr mat-row *matRowDef="let row; columns: displayedHeader" class="whitespace-nowrap"></tr>
    </table>
  </div>
</div>
